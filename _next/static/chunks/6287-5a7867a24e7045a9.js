(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6287],{79391:function(){},68535:function(e,t,a){"use strict";let n;a.d(t,{Vm:function(){return getPtypoolYields},XF:function(){return getTokenPrices}});var s=a(7745),o=a(44769),l=a(83606);let instance=()=>(n&&n.defaults.baseURL==="https://earlyaccess-beta.".concat(o.Kh.value,"/api")||(n=l.Z.create({baseURL:"https://earlyaccess-beta.".concat(o.Kh.value,"/api"),timeout:1e4,headers:{"Content-Type":"application/json"}})),n);var r={get:async function(e){var t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e.startsWith("/auth")){let e=localStorage.getItem("earlyaccess-token");if(!e)throw"Need token";n.headers={...n.headers||{},Authorization:e}}let s=await instance().get(e,{...n,params:a});if(console.info("res:",null==s?void 0:s.data),(null==s?void 0:null===(t=s.data)||void 0===t?void 0:t.code)!==200)throw s.data;return s.data.data},post:async function(e){var t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e.startsWith("/auth")){let e=localStorage.getItem("earlyaccess-token");if(!e)throw"Need token";n.headers={...n.headers||{},Authorization:e}}let s=await instance().post(e,a,n);if((null==s?void 0:null===(t=s.data)||void 0===t?void 0:t.code)!==200)throw s.data;return s.data.data}};let getPtypoolYields=async()=>{let e=await r.get("/common/ptypool/yields");return e},getTokenPrices=async()=>{let e=await l.Z.post("https://api.g.alchemy.com/prices/v1/7UXJgo01vxWHLJDk09Y0qZct8Y3zMDbX/tokens/by-address",{addresses:[{network:"story-mainnet",address:"0x1514000000000000000000000000000000000000"},{network:"story-mainnet",address:"0xb5461c1FD0312Cd4bF037058F8a391e6A42F9639"}]});return e.data.data.map(e=>({address:e.address,price:(0,s.f)(e.prices[0].value)}))}},22139:function(e,t,a){"use strict";a.d(t,{Hj:function(){return s},Pq:function(){return o},QG:function(){return r},pn:function(){return l},v:function(){return n},xb:function(){return DOC_LINK}});let n="https://twitter.com/WandProtocol",s="https://discord.gg/fy6A7JCE5N",o=BigInt(1e18),l=864e5,DOC_LINK=()=>"https://docs.wandfi.io",r="https://app.wandfi.io"},44769:function(e,t,a){"use strict";a.d(t,{Kh:function(){return s},Vi:function(){return useConfigDomain}});var n=a(64103);let s={value:"wandfi.io"},o=["wandfi.io","wandfi.xyz"],getAvilableDomain=()=>{var e;if("localhost"==location.hostname||(null===(e=location.hostname.match(/^\d+\.\d+\.\d+\.\d+$/))||void 0===e?void 0:e.length)==1)return o[0];let t=location.hostname.split("."),a=t.slice(-2).join(".");return("ipns"==t[1]&&(a=t[0].replaceAll("-",".")),o.includes(a))?a:o[0]};function useConfigDomain(){(0,n.useEffect)(()=>{s.value=getAvilableDomain()},[])}},9068:function(e,t,a){"use strict";a.d(t,{g:function(){return N},A:function(){return FetcherProvider}});var n=a(31113),s=a(26504),o=a(68535),l=a(20449),r=a(19757);let getTokens=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return r.iK[e].map(e=>({symbol:e.assetTokenSymbol,address:e.assetTokenAddress})).concat(r.iK[e].map(e=>({symbol:e.xTokenSymbol,address:e.xTokenAddress}))).concat([{symbol:"USB",address:r.O1[e]}]).concat((r.VQ[e]||[]).map(e=>({symbol:e.assetTokenSymbol,address:e.assetToken}))).filter(e=>!t||e.symbol!==(0,l.b)())};var i=a(22139),d=a(59175),u=a(64103),c=a(20168),m=a(87958),b=a(41340);function useMemoOfChainId(e){let t=(0,d.p)(),a=(0,u.useRef)({});return(0,u.useMemo)(()=>(a.current[t]||(a.current[t]=e()),a.current[t]),[t])}var f=a(26361),p=a(72366),v=a(15506),h=a(12396),k=a(48338);let y=(0,k.Ue)(e=>({update:e}));var g=a(64370),S=a(83978),A=a.n(S),Y=a(68940),T=a(74819),M=a(22298),w=a(7530),D=a(28294),C=a(96634);let N=(0,u.createContext)({balances:(0,f.Yb)({},0n),totalSupplies:(0,f.Yb)({},0n),prices:(0,f.Yb)({},0n),assetLocked:(0,f.Yb)({},0n),aar:(0,f.Yb)({},0),vaultUSBTotal:(0,f.Yb)({},0n),vaultsMode:(0,f.Yb)({},0),vaultsDiscount:(0,f.Yb)({},!1),vaultsState:(0,f.Yb)({},(0,f.Yb)({},0n)),stableVaultsState:(0,f.Yb)({},(0,f.Yb)({},0n)),earns:(0,f.Yb)({},(0,f.Yb)({},0n)),usbApr:{apr:0n,aprDecimals:10},plainVaultsStat:(0,f.Yb)({},(0,f.Yb)({},0n))}),FetcherProvider=e=>{let{children:t}=e,a=(0,v.hp)(),k=(0,d.p)();!function(){let{chainId:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,c.m)({chainId:e});u.useMemo(()=>(t&&(l.ON.provider=function(e){var t,a;let{chain:n,transport:s}=e,o={chainId:n.id,name:n.name,ensAddress:null===(a=n.contracts)||void 0===a?void 0:null===(t=a.ensRegistry)||void 0===t?void 0:t.address};return"fallback"===s.type?new m.H(s.transports.map(e=>{let{value:t}=e;return new b.r(null==t?void 0:t.url,o)})):new b.r(s.url,o)}(t)),l.ON.provider),[t])}();let{address:S}=(0,p.m)(),{data:P}=(0,C.K)({address:S,chainId:k,query:{enabled:!!S,refetchOnMount:!1,refetchOnWindowFocus:!1},wandtime:a.time}),B=(0,u.useMemo)(()=>getTokens(k),[k]),{data:O}=(0,v.uX)({contracts:[...B.map(e=>({address:e.address,abi:M.Wo,functionName:"balanceOf",args:[S],chainId:k}))],query:{enabled:!!S}}),{data:I}=(0,v.uX)({contracts:[...B.map(e=>({address:e.address,abi:M.Wo,functionName:"totalSupply",chainId:k}))]}),E=useMemoOfChainId(()=>(0,f.Yb)({},0n));E[r.K8]=(0,f.ok)(P,"value"),B.forEach((e,t)=>{E[e.address]=(0,f.ok)(O,[t,"result"])});let W=useMemoOfChainId(()=>(0,f.Yb)({},0n));B.forEach((e,t)=>{W[e.address]=(0,f.ok)(I,[t,"result"])});let _=r.iK[k],x=function(){let e=(0,d.p)(),t=r.iK[e],{data:a}=(0,v.uX)({contracts:[...t.map(e=>({vc:e,abi:s.nq,address:e.assetTokenFeed,functionName:"latestPrice"}))]}),{data:n}=(0,v.uX)({query:{gcTime:i.pn},contracts:[...t.map(e=>({abi:s.nq,address:e.assetTokenFeed,functionName:"decimals"}))]});return(0,u.useMemo)(()=>{let e={};return t.forEach((t,s)=>{let o=(0,f.ok)(a,[s,"result"]),l=(0,f.ok)(n,[s,"result"]);e[t.assetTokenAddress]=[o,l]}),e},[a,n,t])}(),{data:q}=(0,v.uX)({contracts:[..._.map(e=>({vc:e,abi:s.WW,address:e.vault,functionName:"assetBalance"}))]}),{data:U}=(0,v.uX)({contracts:[..._.map(e=>({abi:s.WW,address:e.vault,functionName:"usbTotalSupply"}))]}),{data:X}=(0,v.uX)({contracts:[..._.map(e=>({vc:e,abi:s.Wn,address:r.O6[k],functionName:"AAR",args:[e.vault]}))]}),{data:K}=(0,v.uX)({query:{gcTime:i.pn},contracts:[..._.map(e=>({abi:s.WW,address:e.vault,functionName:"AARDecimals"}))]}),{data:F}=(0,v.uX)({contracts:[..._.map(e=>({abi:s.WW,address:e.vault,functionName:"vaultMode"}))]}),{data:R}=(0,v.uX)({contracts:[..._.map(e=>({vc:e,abi:s.Wn,address:r.O6[k],functionName:e.isStable?"getStableVaultState":"getVaultState",args:[e.vault]}))]}),{data:V}=(0,v.uX)({query:{gcTime:i.pn},contracts:[..._.map(e=>({vc:e,abi:s.WW,address:e.vault,functionName:"paramValue",args:[(0,T.$G)("Y",{size:32})]}))]}),H=useMemoOfChainId(()=>(0,f.Yb)({[r.O1[k]]:i.Pq},0n)),L=useMemoOfChainId(()=>(0,f.Yb)({},0n)),z=useMemoOfChainId(()=>(0,f.Yb)({},0n)),j=useMemoOfChainId(()=>(0,f.Yb)({},0n)),Z=useMemoOfChainId(()=>(0,f.Yb)({},0)),G=useMemoOfChainId(()=>(0,f.Yb)({},(0,f.Yb)({},0n))),J=useMemoOfChainId(()=>(0,f.Yb)({},(0,f.Yb)({},0n))),Q=function(e,t,a){let n=useMemoOfChainId(()=>(0,f.Yb)({},!1)),o=(0,d.p)(),l=r.iK[o],{data:i}=(0,v.uX)({contracts:l.map(e=>({vc:e,abi:s.WW,address:e.vault,functionName:"paramValue",args:[(0,T.$G)("CircuitBreakPeriod",{size:32})]}))});return l.forEach((s,o)=>{if(s.isStable){let e=t[(null==s?void 0:s.vault)||"null"];n[s.vault]=e&&e.M_USDCx>0n&&e.aar<e.AARS}else{let t=(0,f.ok)(i,[o,"result"]),l=e[(null==s?void 0:s.vault)||"null"],r=a[(null==s?void 0:s.vault)||"null"],d=(0,f.ok)(l,"AARBelowCircuitBreakerLineTime"),u=2==r&&l&&((0,f.ok)(l,"aar")>=(0,f.ok)(l,"AARC")||BigInt(Math.floor(new Date().getTime()/1e3))-d>=t);n[s.vault]=u}}),n}(G,J,Z);_.forEach((e,t)=>{var a,n,s;let o=(0,f.ok)(q,[t,"result"]),l=(0,f.ok)(U,[t,"result"]),d=(0,f.ok)(x[e.assetTokenAddress],[0]),u=(0,f.ok)(x[e.assetTokenAddress],[1]);j[e.vault]=l;let c=u>0n?d*i.Pq/10n**u:0n;H[e.assetTokenAddress]=c;let m=W[e.xTokenAddress],b=m>0n&&o>0n&&c>0n&&l>0n&&o*c>l*i.Pq?(o*c-l*i.Pq)/m:0n;m>0n&&o>0n&&c>0n&&l>0n&&o*c<l*i.Pq&&(H[r.O1[k]]=o*c/l),H[e.xTokenAddress]=b,L[e.assetTokenAddress]=o;let p=(0,w.b)((0,f.ok)(X,[t,"result"]),parseInt((0,f.ok)(K,[t,"result"]).toString()));z[e.vault]=parseFloat(p),e.isStable?J[e.vault]=(0,f.Yb)({settingsDecimals:10n,...null==R?void 0:null===(n=R[t])||void 0===n?void 0:n.result,Y:(0,f.ok)(V,[t,"result"])},0n):G[e.vault]=(0,f.Yb)({settingsDecimals:10n,...null==R?void 0:null===(s=R[t])||void 0===s?void 0:s.result,Y:(0,f.ok)(V,[t,"result"])},0n);let v=J[e.vault];Z[e.vault]=e.isStable?v.aar<v.AARS&&v.M_USDC>0n?2:1:(null==F?void 0:null===(a=F[t])||void 0===a?void 0:a.result)||0});let $=function(){let{address:e}=(0,p.m)(),t=(0,d.p)(),a=(0,u.useMemo)(()=>r.iK[t].filter(e=>!e.isStable&&e.ptyPoolAboveAddress&&e.ptyPoolBelowAddress).map(e=>[{poolAddress:e.ptyPoolBelowAddress,stakeSymbol:"USB",matchSymbol:e.assetTokenSymbol,earnSymbol:e.xTokenSymbol,earnForMatchSymbol:e.assetTokenSymbol},{poolAddress:e.ptyPoolAboveAddress,stakeSymbol:e.assetTokenSymbol,matchSymbol:"USB",earnSymbol:e.assetTokenSymbol,earnForMatchSymbol:e.xTokenSymbol}]).flat(),[t]),{data:n}=(0,v.uX)({query:{enabled:!!e},contracts:[...a.map(t=>{let{poolAddress:a}=t;return{abi:s.aT,address:a,functionName:"userStakingBalance",args:[e]}}),...a.map(t=>{let{poolAddress:a}=t;return{abi:s.aT,address:a,functionName:"earnedMatchedToken",args:[e]}}),...a.map(t=>{let{poolAddress:a}=t;return{abi:s.aT,address:a,functionName:"earnedStakingYields",args:[e]}}),...a.map(t=>{let{poolAddress:a}=t;return{abi:s.aT,address:a,functionName:"earnedMatchingYields",args:[e]}})]}),{data:o}=(0,v.uX)({contracts:[...a.map(e=>{let{poolAddress:t}=e;return{abi:s.aT,address:t,functionName:"totalStakingBalance"}})]}),i=(0,D.t)(),{data:c}=(0,g.a)({queryKey:[a,i],initialData:(0,f.Yb)({},0n),queryFn:async()=>{let e=(0,f.Yb)({},0n);if(!i)return e;let t=a.filter(e=>e.matchSymbol==(0,l.b)()),n=await Promise.all(t.map(e=>i.getBalance({address:e.poolAddress})));return t.forEach((t,a)=>{e[t.poolAddress]=n[a]}),e}}),m=useMemoOfChainId(()=>(0,f.Yb)({},(0,f.Yb)({},0n)));return a.forEach((e,t)=>{let{poolAddress:s,stakeSymbol:l,matchSymbol:r,earnSymbol:i}=e,d=(0,f.ok)(n,[t,"result"]),u=(0,f.ok)(n,[t+a.length,"result"]),b=(0,f.ok)(n,[t+2*a.length,"result"]),p=(0,f.ok)(n,[t+3*a.length,"result"]),v=(0,f.ok)(o,[t,"result"]);m[s]={stakeSymbol:l,matchSymbol:r,earnSymbol:i,stake:d,match:u,earn:b,earnForMatch:p,totalStake:v,balance:c[s]||0n}}),m}(),ee=function(e,t){let a=(0,d.p)(),n=0,s=0n,o=0n;return r.iK[a].forEach(a=>{if(a.isStable){let e=t[a.vault];s+=e.M_USB_USDC*e.Y*e.aar/10n**e.AARDecimals,o+=e.M_USB_USDC,e.M_USB_USDC>0n&&e.Y>0n&&n++}else{let t=e[a.vault];s+=t.M_USB_ETH*t.Y,o+=t.M_USB_ETH,t.M_USB_ETH>0n&&t.Y>0n&&n++}}),{apr:o>0n?s/o:0n,aprDecimals:10}}(G,J);(0,u.useEffect)(()=>{setInterval(()=>{let e=v.hp.getState();A().now()-e.time>=36e5&&e.update()},36e5)},[]);let{value:et={}}=(0,Y.Z)(o.Vm,[a.time]);!function(e,t,a){let n=(0,d.p)(),s=r.iK[n],o=Object.values(e).reduce((e,t)=>t.totalStake+e,0n),{update:l}=y();(0,u.useEffect)(()=>{s.forEach(s=>{let o=a[s.vault];if(s.ptyPoolAboveAddress&&e[s.ptyPoolAboveAddress]&&l({[s.ptyPoolAboveAddress]:{staking:(0,h.v)("0.025",10),matching:0n}}),s.ptyPoolBelowAddress&&e[s.ptyPoolBelowAddress]){let a=e[s.ptyPoolBelowAddress].totalStake*t[r.O1[n]];console.info("hhh:",a);let d=a>0n&&o.settingsDecimals>0n?o.M_ETHx*o.Y*t[s.xTokenAddress]*i.Pq/2n/a/o.settingsDecimals**10n:0n;l({[s.ptyPoolBelowAddress]:{staking:d*10n**10n/i.Pq,matching:0n}})}})},[s,o,e,t,a])}($,H,G);let ea=function(e){let t=(0,d.p)(),{address:a}=(0,p.m)(),n=r.VQ[t]||[],{data:o}=(0,v.uX)({contracts:[...n.map(e=>({abi:s.a4,address:e.vault,functionName:"totalSupply"})),...n.map(e=>({abi:s.a4,address:e.vault,functionName:"balanceOf",args:[a]}))]}),{data:i}=(0,v.uX)({contracts:[{abi:s.pE,address:"0xcD96262Df56127f298b452FA40759632868A472a",functionName:"latestRoundData",chainId:l.mx.id},{abi:s.pE,address:"0x0af23B08bcd8AD35D1e8e8f2D2B779024Bd8D24A",functionName:"latestRoundData",chainId:l.mx.id}]}),u=(0,f.ok)(i,[0,"result",1]),c=(0,f.ok)(i,[1,"result",1]),m=u*c*10n**2n,b=useMemoOfChainId(()=>(0,f.Yb)({},(0,f.Yb)({},0n)));return n.forEach((t,a)=>{"weETH"==t.assetTokenSymbol&&(e[t.assetToken]=m),b[t.vault]=b[t.vault],b[t.vault].totalSupply=(0,f.ok)(o,[a,"result"]),b[t.vault].userStaked=(0,f.ok)(o,[a+n.length,"result"])}),b}(H);return(0,n.jsx)(N.Provider,{value:{balances:E,totalSupplies:W,prices:H,assetLocked:L,aar:z,vaultUSBTotal:j,vaultsMode:Z,vaultsDiscount:Q,vaultsState:G,stableVaultsState:J,earns:$,usbApr:ee,ptypoolYields:et,plainVaultsStat:ea},children:t})}}}]);